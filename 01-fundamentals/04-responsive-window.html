<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>示例4：响应式窗口调整</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background-color: #000;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #size-info {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="info">示例4：响应式窗口调整 - 尝试调整浏览器窗口大小</div>
    <div id="size-info">
        窗口尺寸：<span id="width">0</span> x <span id="height">0</span>
    </div>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';

        // 创建场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);

        // 创建相机
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.z = 5;

        // 创建渲染器
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        // 添加光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        // 创建多个物体
        const geometries = [
            new THREE.BoxGeometry(1, 1, 1),
            new THREE.SphereGeometry(0.5, 32, 32),
            new THREE.ConeGeometry(0.5, 1, 32),
            new THREE.TorusGeometry(0.5, 0.2, 16, 100),
            new THREE.OctahedronGeometry(0.6)
        ];

        const colors = [0xff6b6b, 0x4ecdc4, 0xffe66d, 0x95e1d3, 0xf38181];

        const meshes = [];

        for (let i = 0; i < 5; i++) {
            const material = new THREE.MeshStandardMaterial({ 
                color: colors[i],
                roughness: 0.5,
                metalness: 0.2
            });
            const mesh = new THREE.Mesh(geometries[i], material);
            
            // 将物体排列成一行
            mesh.position.x = (i - 2) * 1.5;
            mesh.position.y = Math.sin(i) * 0.5;
            
            scene.add(mesh);
            meshes.push(mesh);
        }

        // 添加坐标轴辅助线
        const axesHelper = new THREE.AxesHelper(3);
        scene.add(axesHelper);

        // 添加网格辅助线
        const gridHelper = new THREE.GridHelper(10, 10);
        scene.add(gridHelper);

        // 更新窗口尺寸显示
        const widthSpan = document.getElementById('width');
        const heightSpan = document.getElementById('height');
        
        function updateSizeInfo() {
            widthSpan.textContent = window.innerWidth;
            heightSpan.textContent = window.innerHeight;
        }
        
        updateSizeInfo();

        // 响应式窗口调整函数
        function onWindowResize() {
            // 获取新的窗口尺寸
            const width = window.innerWidth;
            const height = window.innerHeight;

            // 更新相机的宽高比
            // 宽高比决定了场景的透视效果，保持正确的比例可以防止物体变形
            camera.aspect = width / height;
            
            // 更新相机的投影矩阵
            // 投影矩阵决定了3D场景如何投影到2D屏幕上
            camera.updateProjectionMatrix();

            // 更新渲染器的尺寸
            renderer.setSize(width, height);

            // 更新像素比，优化高清屏显示效果
            // devicePixelRatio表示物理像素与CSS像素的比例
            // 使用Math.min限制最大值为2，避免在高DPI设备上性能问题
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // 更新尺寸显示
            updateSizeInfo();
        }

        // 监听窗口大小变化事件
        // 当用户调整浏览器窗口大小时，会触发resize事件
        window.addEventListener('resize', onWindowResize);

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);

            // 让每个物体旋转
            meshes.forEach((mesh, index) => {
                mesh.rotation.x += 0.01 * (index + 1);
                mesh.rotation.y += 0.015 * (index + 1);
            });

            // 渲染场景
            renderer.render(scene, camera);
        }

        animate();

        // 初始调用一次，确保尺寸正确
        onWindowResize();
    </script>
</body>
</html>
